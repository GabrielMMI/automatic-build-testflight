
PROJECT_PATH_AND_NAME=$1
SCHEME=$2
PLIST=$3
STATIC_NUM_BUILD=$4

BUILD_NUMBER=$(/usr/libexec/PlistBuddy -c "Print :CFBundleVersion" ${PLIST})

if [ -z "${STATIC_NUM_BUILD}" ]
then
	if [[ $BUILD_NUMBER == '$(CURRENT_PROJECT_VERSION)' ]]; then
	    BUILD_NUMBER=$(xcodebuild -project ${PROJECT_PATH_AND_NAME}.xcodeproj -scheme ${SCHEME} -showBuildSettings | grep "CURRENT_PROJECT_VERSION" | sed 's/[ ]*CURRENT_PROJECT_VERSION = //')
	fi

	NEXT_BUILD_NUMBER=$(expr $BUILD_NUMBER)

else
	NEXT_BUILD_NUMBER=${STATIC_NUM_BUILD}
fi

/usr/libexec/PlistBuddy -c "Set :CFBundleVersion $NEXT_BUILD_NUMBER" $2